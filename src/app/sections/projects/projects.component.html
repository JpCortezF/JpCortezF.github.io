<div class="max-w-5xl mx-auto">
  <p class="text-white/50 text-sm tracking-wide mb-2">Portfolio</p>
  <h2 class="text-2xl md:text-3xl font-bold text-white mb-10">Proyectos</h2>

  <div class="projects-grid grid grid-cols-1 md:grid-cols-2 gap-5"
      [class.slide-left]="pageAnim === 'slide-left'"
      [class.slide-right]="pageAnim === 'slide-right'">

    @for (p of pagedProjects; track p.name) {
      <app-project-card 
        [p]="p"
        (open)="openProject($event)"
        (toggle)="toggleDetails($event)"
      />
    } @empty {
      <p class="text-white/60">Todavía no hay proyectos para mostrar.</p>
    }
  </div>

  <!-- ✅ PAGINACIÓN -->
  <div class="mt-10 flex items-center justify-between">
    <button
      type="button"
      (click)="prevPage()"
      [disabled]="page === 0"
      class="rounded-full px-4 py-2 text-sm font-semibold border border-white/15
             text-white/80 hover:text-white hover:border-white/30 transition
             disabled:opacity-30 disabled:hover:border-white/15 disabled:hover:text-white/80"
    >
      &lt; Volver
    </button>

    <span class="text-white/50 text-sm">
      {{ page + 1 }} / {{ totalPages }}
    </span>

    <button
      type="button"
      (click)="nextPage()"
      [disabled]="page >= totalPages - 1"
      class="inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold
             bg-white text-black hover:bg-white/90 transition
             disabled:opacity-30 disabled:hover:bg-white"
    >
      Ver más proyectos <span class="text-lg leading-none">&gt;</span>
    </button>
  </div>
</div>


<!-- ✅ MODAL PRO (click en imagen) -->
@if (modalOpen && selectedProject) {
  <div
    class="fixed inset-0 z-50 grid place-items-center px-4 py-6 bg-black/60 backdrop-blur-md"
    role="dialog"
    aria-modal="true"
    (click)="closeModal()"
  >
    <div
      class="modal-shell w-full max-w-5xl max-h-[86vh] overflow-auto rounded-2xl border border-white/10 bg-white/5 p-5 md:p-6"
      (click)="$event.stopPropagation()"
    >
      <div class="flex items-start justify-between gap-4">
        <div>
          <p class="text-white/50 text-xs tracking-wide">Proyecto</p>
          <h3 class="text-white font-semibold text-xl md:text-2xl mt-1">
            {{ selectedProject.name }}
          </h3>
          <p class="text-white/70 mt-2 max-w-3xl">
            {{ selectedProject.description }}
          </p>
        </div>

        <button
          type="button"
          (click)="closeModal()"
          aria-label="Cerrar"
          title="Cerrar (Esc)"
          class="shrink-0 w-10 h-10 grid place-items-center rounded-full
                 border border-white/15 bg-black/25 text-white/85
                 hover:bg-black/40 hover:border-white/25 transition"
        >
          &times;
        </button>
      </div>

      <!-- ✅ Media grande (NORMAL / MOBILE) -->
      @if (selectedProject.gallery?.length) {
        <div class="mt-5 rounded-2xl border border-white/10 bg-black/35 p-4">

          <!-- ✅ MOBILE MODE -->
          @if (selectedProject.isMobile) {
            <div class="mx-auto phone-frame">
              <button
                type="button"
                (click)="prevImg(selectedProject)"
                aria-label="Anterior"
                class="phone-nav phone-nav-left"
              >
                &lsaquo;
              </button>

              <img
                class="phone-shot"
                [src]="selectedProject.gallery?.[selectedProject.galleryIndex || 0]"
                [alt]="selectedProject.name + ' screenshot'"
                loading="eager"
                decoding="async"
              />

              <button
                type="button"
                (click)="nextImg(selectedProject)"
                aria-label="Siguiente"
                class="phone-nav phone-nav-right"
              >
                &rsaquo;
              </button>
            </div>
          } @else {
            <!-- ✅ NORMAL MODE -->
            <div class="relative overflow-hidden rounded-2xl border border-white/10 bg-black/35">
              <button
                type="button"
                (click)="prevImg(selectedProject)"
                aria-label="Anterior"
                class="absolute left-3 top-1/2 -translate-y-1/2
                      w-11 h-11 rounded-full grid place-items-center
                      border border-white/15 bg-black/35 text-white/90 text-3xl
                      hover:bg-black/55 hover:border-white/25 transition"
              >
                &lsaquo;
              </button>

              <img
                class="w-full h-80 md:h-130 object-cover block saturate-105 contrast-[1.03]"
                [src]="selectedProject.gallery?.[selectedProject.galleryIndex || 0]"
                [alt]="selectedProject.name + ' screenshot'"
                loading="eager"
                decoding="async"
              />

              <button
                type="button"
                (click)="nextImg(selectedProject)"
                aria-label="Siguiente"
                class="absolute right-3 top-1/2 -translate-y-1/2
                      w-11 h-11 rounded-full grid place-items-center
                      border border-white/15 bg-black/35 text-white/90 text-3xl
                      hover:bg-black/55 hover:border-white/25 transition"
              >
                &rsaquo;
              </button>
            </div>
          }

          <!-- ✅ DOTS (sirve para ambos modos) -->
          <div class="mt-3 flex justify-center">
            <div
              class="flex gap-2 px-3 py-2 rounded-full
                    border border-white/15 bg-black/35 backdrop-blur"
            >
              @for (img of selectedProject.gallery; track img; let i = $index) {
                <span
                  role="button"
                  tabindex="0"
                  (click)="setImg(selectedProject, i)"
                  (keydown.enter)="setImg(selectedProject, i)"
                  (keydown.space)="setImg(selectedProject, i)"
                  class="w-2 h-2 rounded-full transition hover:scale-125 cursor-pointer bg-white"
                  [class.opacity-100]="i === (selectedProject.galleryIndex || 0)"
                  [class.opacity-35]="i !== (selectedProject.galleryIndex || 0)"
                ></span>
              }
            </div>
          </div>

        </div>
      }

      @if (selectedProject.pitch) {
        <div class="mt-5 rounded-2xl border border-white/10 bg-black/20 p-5">
          <p class="text-white/80 text-sm tracking-wide mb-2">Sobre el proyecto</p>

          <p class="text-white/75 leading-relaxed">
            {{ selectedProject.pitch }}
          </p>
        </div>
      }

      @if (selectedProject.highlights?.length) {
        <div class="mt-4 rounded-2xl border border-white/10 bg-black/20 p-5">
          <p class="text-white font-semibold mb-2">Highlights</p>
          <ul class="space-y-2 text-white/70 list-disc pl-5">
            @for (h of selectedProject.highlights; track h) {
              <li>{{ h }}</li>
            }
          </ul>
        </div>
      }

      @if (selectedProject.challenges?.length) {
        <div class="mt-4 rounded-2xl border border-white/10 bg-black/20 p-5">
          <p class="text-white font-semibold mb-2">Desafíos técnicos</p>
          <ul class="space-y-2 text-white/70 list-disc pl-5">
            @for (c of selectedProject.challenges; track c) {
              <li>{{ c }}</li>
            }
          </ul>
        </div>
      }

      @if (selectedProject.learnings?.length) {
        <div class="mt-4 rounded-2xl border border-white/10 bg-black/20 p-5">
          <p class="text-white font-semibold mb-2">Lo que aprendí</p>
          <ul class="space-y-2 text-white/70 list-disc pl-5">
            @for (l of selectedProject.learnings; track l) {
              <li>{{ l }}</li>
            }
          </ul>
        </div>
      }
      @if (selectedProject.details?.length) {
        <div class="mt-5 rounded-2xl border border-white/10 bg-black/25 p-5">
          <ul class="space-y-2 text-white/70 list-disc pl-5">
            @for (d of selectedProject.details; track d) {
              <li>{{ d }}</li>
            }
          </ul>
        </div>
      }

      <div class="mt-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="flex flex-wrap gap-2">
          @for (t of selectedProject.tags; track t) {
            <span class="text-xs text-white/70 border border-white/10 bg-black/20 px-2.5 py-1 rounded-full">
              {{ t }}
            </span>
          }
        </div>

        <div class="flex flex-wrap gap-3">
          @if (selectedProject.liveUrl) {
            <a
              class="rounded-full px-4 py-2 text-sm font-semibold bg-white text-black hover:bg-white/90 transition"
              [href]="selectedProject.liveUrl"
              target="_blank"
              rel="noopener noreferrer"
            >Demo</a>
          }
          @if (selectedProject.repoUrl) {
            <a
              class="rounded-full px-4 py-2 text-sm font-semibold border border-white/15 text-white/80 hover:text-white hover:border-white/30 transition"
              [href]="selectedProject.repoUrl"
              target="_blank"
              rel="noopener noreferrer"
            >Repo</a>
          }
          <button
            type="button"
            (click)="closeModal()"
            class="rounded-full px-4 py-2 text-sm font-semibold
                   border border-white/15 text-white/80 hover:text-white hover:border-white/30 transition"
          >
            Cerrar
          </button>
        </div>
      </div>

      <p class="mt-4 text-white/35 text-xs">
        Tip: cerrá con <span class="text-white/60">Esc</span> o tocando fuera del modal.
      </p>
    </div>
  </div>
}
